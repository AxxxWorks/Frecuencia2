<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frecuencia Vital - Plan de Estudio Definitivo 2025</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Source+Sans+Pro:wght@300;400;600;700&display=swap');
        :root{--bg-color:#121212;--cell-bg:#1a1a1a;--main-border:#2c2c2c;--text-color:#e0e0e0;--text-secondary:#a0a0a0;--accent-color:#00FF7F;--meta-bg:#181c25;--meta-header-bg:#101217;--meta-border:#2c3240;--meta-text:#a9bce2;--plan-bg:#1e1e1e;--vfd-green:#50E050;--progress-score-bg:#4caf50;--progress-advance-bg:#ff9800;--text-completed:#777;--bullet-completed:#555;--tag-text-dark:#111;--error-color:#ff6b6b;--warning-color:#ff9800;--shadow-color:rgba(0,0,0,.4);--step-1-color:#03dac6;--step-2-color:#ffb74d;--step-3-color:#4fc3f7;--step-4-color:#ce93d8;--step-5-color:#ef9a9a;--step-6-color:#a5d6a7;--color-todo:var(--text-secondary);--color-inprogress:var(--step-3-color);--color-done:var(--vfd-green)}#login-container{position:fixed;top:0;left:0;width:100%;height:100%;background-color:var(--bg-color);z-index:2000;display:flex;align-items:center;justify-content:center;flex-direction:column;padding:20px}.login-box{background-color:var(--cell-bg);padding:40px;border-radius:12px;border:1px solid var(--main-border);width:100%;max-width:400px;text-align:center;box-shadow:0 5px 25px var(--shadow-color)}.login-box h1{font-family:'Orbitron',sans-serif;color:var(--vfd-green);margin-bottom:30px;font-size:2em;text-shadow:0 0 5px rgba(80,224,80,.7)}.login-box input{width:100%;padding:12px;margin-bottom:15px;background-color:#2c2c2c;border:1px solid var(--main-border);color:var(--text-color);border-radius:6px;font-size:1em}.login-box button{width:100%;padding:12px;background-color:var(--accent-color);color:var(--bg-color);border:none;cursor:pointer;font-family:'Orbitron',sans-serif;font-size:1.1em;border-radius:6px;transition:background-color .2s,transform .1s;margin-top:10px}.login-box button.secondary{background-color:transparent;color:var(--accent-color);border:1px solid var(--accent-color);margin-top:10px}.login-box button:hover{background-color:#39ff94;color:var(--bg-color);border-color:#39ff94}.login-box button:active{transform:scale(.98)}#login-error{color:var(--error-color);margin-top:15px;min-height:1.2em;font-size:.9em}#main-app-content{display:none;height:100vh;flex-direction:column}*{box-sizing:border-box;margin:0;padding:0}body{font-family:'Source Sans Pro',sans-serif;background-color:var(--bg-color);color:var(--text-color);margin:0;overflow:hidden;height:100vh}.app-banner{padding:20px 25px;background-color:var(--bg-color);border-bottom:1px solid var(--main-border);flex-shrink:0;display:flex;flex-direction:column;align-items:center;gap:20px}.banner-top-row{display:flex;justify-content:space-between;align-items:center;width:100%}.banner-bottom-row{display:flex;width:100%;align-items:center;gap:20px}.global-progress-container{flex-grow:1;display:flex;flex-direction:column;gap:10px}.main-content-area{flex-grow:1;overflow-y:auto}.view-wrapper{padding:20px}.view-wrapper.hidden{display:none}.logout-button{background:0 0;border:1px solid var(--error-color);color:var(--error-color);padding:8px 12px;border-radius:6px;font-family:'Orbitron',sans-serif;cursor:pointer;transition:all .2s}.logout-button:hover{background-color:var(--error-color);color:var(--bg-color)}.view-switcher{background-color:var(--accent-color);color:var(--bg-color);border:none;padding:10px 20px;border-radius:6px;font-family:'Orbitron',sans-serif;font-weight:700;cursor:pointer;transition:all .2s ease;flex-shrink:0}.view-switcher:hover{background-color:#39ff94;transform:translateY(-2px)}.motivational-quote{font-family:'Orbitron',sans-serif;color:var(--vfd-green);font-size:1.5em;text-transform:uppercase;letter-spacing:2px;text-shadow:0 0 4px rgba(80,224,80,.6),0 0 8px rgba(80,224,80,.4);min-height:1.2em}.countdown-container{position:relative;display:inline-block}.countdown-timer-container{display:flex;justify-content:center;align-items:center;gap:25px}.countdown-unit{text-align:center}.countdown-label{font-family:'Orbitron',sans-serif;font-size:.8em;color:var(--vfd-green);text-transform:uppercase;letter-spacing:1px;margin-bottom:5px;opacity:.8}.countdown-digits{font-family:'Orbitron',sans-serif;font-size:4em;color:var(--vfd-green);line-height:1;text-shadow:0 0 5px rgba(80,224,80,.7),0 0 10px rgba(80,224,80,.5),0 0 15px rgba(80,224,80,.3)}#edit-countdown-btn{position:absolute;top:-5px;right:-30px;background:0 0;border:none;color:var(--meta-text);font-size:1.2em;cursor:pointer;transition:color .2s}#edit-countdown-btn:hover{color:var(--accent-color)}#countdown-editor{display:none;margin-top:10px;align-items:center;justify-content:center;gap:10px}#countdown-date-picker{background-color:var(--cell-bg);border:1px solid var(--main-border);color:var(--text-color);padding:5px;border-radius:4px;font-family:'Source Sans Pro',sans-serif}#countdown-date-picker::-webkit-calendar-picker-indicator{filter:invert(1);cursor:pointer}#save-countdown-btn{background-color:var(--accent-color);color:var(--bg-color);border:none;padding:6px 12px;border-radius:4px;font-weight:700;cursor:pointer}.progress-bar-wrapper{display:flex;flex-direction:column;gap:4px}.progress-bar-wrapper label{font-size:.85em;color:var(--meta-text);font-weight:600;text-align:left}.progress-bar-background{width:100%;background-color:var(--main-border);border-radius:8px;height:22px;overflow:hidden}.progress-bar-fill{height:100%;width:0%;border-radius:8px;transition:width .5s ease-in-out;text-align:center;line-height:22px;color:var(--bg-color);font-weight:700;font-size:.8em}#global-score-bar{background-color:var(--progress-score-bg)}#global-advance-bar{background-color:var(--progress-advance-bg)}.calendar-container{display:grid;grid-template-columns:40px 40px repeat(7,1fr);gap:2px;background-color:var(--main-border)}.header-cell,.day-header{text-align:center;padding:12px 5px;font-weight:600;font-family:'Orbitron',sans-serif;text-transform:uppercase;font-size:.9em}.meta-header{background-color:var(--meta-header-bg);color:var(--meta-text);border-bottom:2px solid var(--main-border)}.day-header{background-color:var(--cell-bg);color:var(--accent-color);border-bottom:2px solid var(--main-border)}.month-cell{grid-column:1;background-color:var(--meta-bg);color:var(--meta-text);font-family:'Orbitron',sans-serif;writing-mode:vertical-rl;text-transform:uppercase;letter-spacing:2px;display:flex;align-items:center;justify-content:center;border-right:1px solid var(--meta-border)}.week-cell-container{grid-column:2;background-color:var(--meta-bg);position:relative;display:flex;align-items:center;justify-content:center;border-bottom:1px solid var(--meta-border)}.week-number{font-family:'Orbitron',sans-serif;font-size:1.6em;color:var(--meta-text)}.day-cell{background-color:var(--cell-bg);min-height:160px;padding:8px 12px;position:relative;overflow-y:auto;cursor:pointer;transition:all .2s;border:2px solid transparent}.day-cell.empty{background-color:var(--bg-color);cursor:default}.day-cell.drag-over{background-color:var(--meta-bg);border-color:var(--accent-color)}.day-cell.target-date{border-color:var(--error-color);box-shadow:0 0 10px rgba(255,107,107,.4)}.day-cell.target-date .calendar-day-number{color:var(--error-color);font-weight:700}.day-cell.day-before-target{border-color:var(--warning-color)}.day-cell.day-before-target .calendar-day-number{color:var(--warning-color)}.calendar-day-number{font-size:.9em;font-weight:600;color:#777;position:absolute;top:8px;right:12px;z-index:1;transition:color .2s}.day-content ul{list-style-type:none;padding-left:0;margin:25px 0 0}.day-content li{margin-bottom:4px;padding-left:14px;position:relative;font-size:.85em}.day-content .subject-title{color:var(--text-color);font-weight:700;display:block;margin-bottom:6px;text-transform:uppercase;font-size:1em;text-shadow:0 0 4px rgba(255,255,255,.15);padding-left:0;transition:color .4s ease}.day-content .subject-title.subject-completed{color:var(--text-completed);text-shadow:none;font-style:italic}.subject-title::before{content:none!important}.subject-score{color:var(--meta-text);font-size:.8em;font-weight:400;margin-left:8px}.topic-item{display:flex;align-items:center;justify-content:space-between;padding:4px 6px;margin-left:-6px;border-radius:4px;transition:all .2s;border-top:2px solid transparent;border-bottom:2px solid transparent}.topic-item[draggable=true]{cursor:grab}.topic-item.dragging{opacity:.5}.topic-item:not(.topic-completed):not(.dragging):hover{background-color:var(--meta-bg);color:var(--accent-color)}.topic-item.drag-over-top{border-top-color:var(--accent-color)}.topic-item.drag-over-bottom{border-bottom-color:var(--accent-color)}.topic-item::before{content:'■';position:absolute;left:0;top:5px;color:var(--accent-color);font-size:.8em;line-height:1.5;transition:color .3s ease}.topic-score{font-size:.85em;font-weight:700;margin-left:10px;flex-shrink:0}.topic-item.topic-completed{color:var(--text-completed);font-style:italic}.topic-item.topic-completed:hover{color:var(--text-completed);background-color:transparent}.topic-item.topic-completed::before{color:var(--bullet-completed)}.kanban-board{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;height:100%}.kanban-column{background-color:var(--plan-bg);border-radius:12px;display:flex;flex-direction:column;max-height:100%}.kanban-column-header{padding:15px 20px;border-bottom:1px solid var(--main-border);display:flex;align-items:center;gap:10px;position:sticky;top:0;background-color:var(--plan-bg);z-index:10}.kanban-column-header h2{font-size:1.1rem;font-weight:600}#col-todo .kanban-column-header h2,#col-todo .kanban-column-header i{color:var(--color-todo)}#col-inprogress .kanban-column-header h2,#col-inprogress .kanban-column-header i{color:var(--color-inprogress)}#col-done .kanban-column-header h2,#col-done .kanban-column-header i{color:var(--color-done)}.cards-container{flex-grow:1;padding:10px 20px 20px;overflow-y:auto;scrollbar-width:thin;scrollbar-color:var(--main-border) var(--plan-bg)}.specialty-header{display:flex;flex-direction:column;gap:5px;margin:20px 0 10px;padding:10px;border-radius:6px;background-color:var(--meta-bg);border-left:4px solid}.specialty-header-main{display:flex;justify-content:space-between;align-items:center}.specialty-header-main h3{font-size:1.1rem;font-weight:700;margin:0}.specialty-progress-wrapper{display:flex;align-items:center;gap:8px}.specialty-progress-wrapper small{font-size:.7rem;color:var(--meta-text);width:40px;flex-shrink:0}.specialty-progress-container{flex-grow:1;height:8px;background-color:var(--main-border);border-radius:4px}.specialty-progress-bar{height:100%;width:0%;border-radius:4px;transition:all .3s ease;background-color:var(--progress-advance-bg)}.specialty-score-bar{height:100%;width:0%;border-radius:4px;transition:all .3s ease}.specialty-score-bar.low{background-color:var(--error-color)}.specialty-score-bar.medium{background-color:var(--warning-color)}.specialty-score-bar.high{background-color:var(--vfd-green)}.specialty-percentage-text{font-size:.8em;font-weight:600;color:var(--text-secondary);width:45px;text-align:right;flex-shrink:0}.kanban-card{background-color:var(--cell-bg);border-radius:8px;margin-bottom:10px;box-shadow:0 2px 8px var(--shadow-color);cursor:pointer;transition:border-left-color .3s}.kanban-card:hover{background-color:var(--meta-bg)}.card-summary{padding:12px 15px}.card-topic-name{font-weight:600}.card-progress-display{display:flex;align-items:center;gap:15px;margin-top:10px}.card-progress-bar-container{flex-grow:1;height:6px;background-color:var(--main-border);border-radius:3px}.card-progress-bar{height:100%;width:0%;border-radius:3px;transition:width .3s ease}.card-progress-text,.card-score-text{font-size:.75rem;font-weight:600;color:var(--text-secondary)}.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);backdrop-filter:blur(4px);z-index:998;display:none;opacity:0;transition:opacity .3s ease}.modal-overlay.visible{display:block;opacity:1}.modal-container{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background-color:var(--cell-bg);border:1px solid var(--main-border);border-radius:12px;box-shadow:0 5px 25px rgba(0,0,0,.5);z-index:1000;width:90%;max-height:90vh;display:none;flex-direction:column;transition:transform .3s ease,opacity .3s ease}.modal-container.visible{display:flex}.modal-header{padding:15px 25px;border-bottom:1px solid var(--main-border);display:flex;justify-content:space-between;align-items:center}.modal-header h2{margin:0;font-family:'Orbitron',sans-serif;font-size:1.5em}.modal-close{font-size:2em;color:#888;cursor:pointer;line-height:1;transition:color .2s}.modal-close:hover{color:var(--text-color)}.modal-content{padding:25px;overflow-y:auto}#details-modal{max-width:650px;z-index:1000}#details-modal .modal-header h2{color:var(--accent-color)}#modal-notes{width:100%;box-sizing:border-box;min-height:120px;background-color:#2c2c2c;border:1px solid var(--main-border);color:var(--text-color);padding:10px;resize:vertical;border-radius:4px}#modal-save-btn{width:100%;padding:12px;margin-top:10px;background-color:var(--accent-color);color:var(--bg-color);border:none;cursor:pointer;font-family:'Orbitron',sans-serif;font-size:1em;border-radius:4px;transition:background-color .2s,transform .1s}#modal-save-btn:hover{background-color:#39ff94}#modal-save-btn:active{transform:scale(.98)}#topic-plan-modal{max-width:900px;z-index:1001;background-color:var(--bg-color)}#topic-plan-modal .modal-header h2{color:var(--vfd-green);font-size:1.3em}#topic-plan-modal .modal-content{padding:15px 25px}.study-flow-diagram{display:flex;flex-direction:column;gap:15px;width:100%}.step-card{border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.3);padding:12px 18px;display:flex;align-items:flex-start;transition:opacity .3s ease,border-left-color .3s ease;border-left-style:solid;border-left-width:5px;background-color:var(--plan-bg)}.step-card.completed{border-left-color:#505050!important;opacity:.65}.step-card.completed .step-icon-container,.step-card.completed .step-title,.step-card.completed .step-details li{color:#909090!important}.step-card.completed .step-number{background-color:#383838!important;color:#787878!important}.step-icon-container{font-size:1.8em;margin-right:15px;padding-top:2px;min-width:35px;text-align:center}.step-content{flex-grow:1}.step-title{font-size:1.2em;font-weight:600;margin:0 0 10px;display:flex;align-items:center;color:var(--text-color)}.step-title .subtitle{font-size:.7em;color:#999;margin-left:8px;font-weight:400;text-transform:none}.step-number{color:#101010;border-radius:50%;width:26px;height:26px;display:inline-flex;align-items:center;justify-content:center;font-size:.7em;font-weight:700;margin-right:8px;flex-shrink:0}.step-details{list-style:none;padding-left:0;margin:0}.step-details li{margin-bottom:8px;font-size:.9em;line-height:1.4;display:flex;align-items:center;color:var(--meta-text)}.step-details li label{display:flex;align-items:center;cursor:pointer;width:100%}.task-checkbox{margin-right:10px;accent-color:var(--vfd-green);transform:scale(1.1)}.task-text{transition:text-decoration .3s ease,color .3s ease}input[type=checkbox]:checked+label .task-text,input[type=checkbox]:checked~.task-text{text-decoration:line-through;color:#6a6a6a}.optional-tag{font-size:.8em;color:#888;margin-left:5px;font-style:italic}.tool-tag{padding:2px 8px;border-radius:12px;font-size:.75em;font-weight:600;margin-left:8px;border:1px solid}.tag-madera{background-color:#c8e6c9;color:var(--tag-text-dark);border-color:#a5d6a7}.tag-ia{background-color:#bbdefb;color:var(--tag-text-dark);border-color:#90caf9}.tag-genspark{background-color:#ffecb3;color:var(--tag-text-dark);border-color:#ffe082}.tag-notebooklm{background-color:#d1c4e9;color:var(--tag-text-dark);border-color:#b39ddb}.step-1{border-left-color:var(--step-1-color)}.step-1 .step-icon-container{color:var(--step-1-color)}.step-1 .step-number{background-color:var(--step-1-color)}.step-2{border-left-color:var(--step-2-color)}.step-2 .step-icon-container{color:var(--step-2-color)}.step-2 .step-number{background-color:var(--step-2-color)}.step-3{border-left-color:var(--step-3-color)}.step-3 .step-icon-container{color:var(--step-3-color)}.step-3 .step-number{background-color:var(--step-3-color)}.step-4{border-left-color:var(--step-4-color)}.step-4 .step-icon-container{color:var(--step-4-color)}.step-4 .step-number{background-color:var(--step-4-color)}.step-5{border-left-color:var(--step-5-color)}.step-5 .step-icon-container{color:var(--step-5-color)}.step-5 .step-number{background-color:var(--step-5-color)}.step-6{border-left-color:var(--step-6-color)}.step-6 .step-icon-container{color:var(--step-6-color)}.step-6 .step-number{background-color:var(--step-6-color)}.parallel-steps-container{display:flex;gap:15px}.parallel-steps-container .step-card{flex:1}.practice-step-layout{display:flex;flex-direction:row;gap:15px;width:100%}.practice-tasks-column{flex:2}.practice-score-column{flex:1}.practice-score-column h3{font-size:.9em;color:#ccc;margin:0 0 8px;font-weight:500;text-transform:uppercase}.score-inputs-row{display:flex;gap:8px}.score-input-group{flex-grow:1}.score-input-group label{font-size:.75em;color:#bbb}.score-input-group input{font-family:'Source Sans Pro',sans-serif;background-color:#2a2a2a;color:#e0e0e0;border:1px solid #444;border-radius:4px;padding:5px 8px;font-size:.9em;width:100%;box-sizing:border-box;text-align:center}.score-input-group input[type=number]::-webkit-inner-spin-button,.score-input-group input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.score-input-group input[type=number]{-moz-appearance:textfield}.percentage-output{font-weight:700;background-color:var(--plan-bg)!important;cursor:default}.topic-modal-footer{margin-top:25px;padding-top:15px;border-top:1px solid var(--main-border);text-align:right}.topic-finish-btn{background-color:var(--vfd-green);color:var(--bg-color);border:none;border-radius:6px;padding:12px 25px;font-family:'Orbitron',sans-serif;font-size:1em;font-weight:700;text-transform:uppercase;cursor:pointer;transition:background-color .2s ease,transform .2s ease}.topic-finish-btn:hover{background-color:#76ff76;transform:translateY(-2px)}@media (max-width:768px){.motivational-quote{font-size:1.2em}.countdown-digits{font-size:3em}.countdown-timer-container{gap:15px}.parallel-steps-container,.practice-step-layout,.kanban-board{flex-direction:column;display:block}.kanban-column{margin-bottom:20px}.day-cell{min-height:120px}}@media (max-width:600px){.banner-bottom-row{flex-direction:column}.motivational-quote{font-size:1em;letter-spacing:1px}.countdown-digits{font-size:2.2em}.countdown-label{font-size:.6em}.countdown-timer-container{gap:10px}body{padding:0}.view-wrapper{padding:10px}.calendar-container{grid-template-columns:30px 30px repeat(7,1fr)}.modal-content{padding:15px}.step-card{flex-direction:column}.step-icon-container{text-align:left;margin-bottom:5px}#edit-countdown-btn{right:-5px;top:-15px}}
    </style>
</head>
<body>
    
    <div id="login-container">
        <div class="login-box">
            <h1>Frecuencia Vital</h1>
            <input type="email" id="login-email" placeholder="Correo electrónico">
            <input type="password" id="login-password" placeholder="Contraseña">
            <p id="login-error"></p>
            <button id="login-button">Iniciar Sesión</button>
            <button id="signup-button" class="secondary">Registrarse</button>
        </div>
    </div>

    <div id="main-app-content">
        <header class="app-banner">
            <div class="banner-top-row">
                 <div id="motivational-quote-container" class="motivational-quote"></div>
                 <button class="logout-button" id="logout-button">Cerrar Sesión</button>
            </div>
            <div class="countdown-container">
                <div class="countdown-timer-container">
                    <div class="countdown-unit"><div class="countdown-label">Days</div><div class="countdown-digits" id="countdown-days">000</div></div>
                    <div class="countdown-unit"><div class="countdown-label">Hours</div><div class="countdown-digits" id="countdown-hours">00</div></div>
                    <div class="countdown-unit"><div class="countdown-label">Minutes</div><div class="countdown-digits" id="countdown-minutes">00</div></div>
                    <div class="countdown-unit"><div class="countdown-label">Seconds</div><div class="countdown-digits" id="countdown-seconds">00</div></div>
                </div>
                <button id="edit-countdown-btn" title="Editar fecha final"><i class="fas fa-calendar-alt"></i></button>
            </div>
            <div id="countdown-editor">
                <input type="date" id="countdown-date-picker">
                <button id="save-countdown-btn">Guardar</button>
            </div>
            <div class="banner-bottom-row">
                <div class="global-progress-container">
                    <div class="progress-bar-wrapper">
                        <label id="global-score-label">Puntuación Global (Promedio de Calificaciones)</label>
                        <div class="progress-bar-background"><div class="progress-bar-fill" id="global-score-bar" role="progressbar">0%</div></div>
                    </div>
                    <div class="progress-bar-wrapper">
                        <label id="global-advance-label">Avance Global (Temas Completados)</label>
                        <div class="progress-bar-background"><div class="progress-bar-fill" id="global-advance-bar" role="progressbar">0%</div></div>
                    </div>
                </div>
                <button id="view-switcher" class="view-switcher" data-current-view="calendar">
                    <i class="fas fa-columns"></i> Tablero Vital
                </button>
            </div>
        </header>

        <main class="main-content-area">
            <div id="calendar-view" class="view-wrapper">
                <div class="calendar-container" id="calendar-container"></div>
            </div>
            <div id="board-view" class="view-wrapper hidden">
                <main class="kanban-board">
                    <section class="kanban-column" id="col-todo">
                        <div class="kanban-column-header"><h2><i class="far fa-circle" style="margin-right: 8px;"></i>Sin Empezar</h2></div>
                        <div class="cards-container" id="col-todo-container"></div>
                    </section>
                    <section class="kanban-column" id="col-inprogress">
                        <div class="kanban-column-header"><h2><i class="fas fa-spinner" style="margin-right: 8px;"></i>En Curso</h2></div>
                        <div class="cards-container" id="col-inprogress-container"></div>
                    </section>
                    <section class="kanban-column" id="col-done">
                        <div class="kanban-column-header"><h2><i class="fas fa-check-circle" style="margin-right: 8px;"></i>Listo</h2></div>
                        <div class="cards-container" id="col-done-container"></div>
                    </section>
                </main>
            </div>
        </main>
        
        <div class="modal-overlay" id="modal-overlay"></div>
        <div class="modal-container" id="details-modal">
            <div class="modal-header"> <h2 id="modal-title"></h2> <span class="modal-close" id="modal-close-day">×</span> </div>
            <div class="modal-content"> <div id="modal-topics"></div> <div class="notes-section" style="margin-top: 20px;"> <h3>Mis Anotaciones del Día</h3> <textarea id="modal-notes" placeholder="Escribe aquí tus notas generales para este día..."></textarea> <button id="modal-save-btn">Guardar Nota</button> </div> </div>
        </div>
        <div class="modal-overlay" id="topic-plan-overlay"></div>
        <div class="modal-container" id="topic-plan-modal">
            <div class="modal-header"> <h2 id="topic-plan-title"></h2> <span class="modal-close" id="modal-close-topic">×</span> </div>
            <div class="modal-content">
                <div class="study-flow-diagram">
                    <div class="step-card step-1"> <div class="step-icon-container"><i class="fas fa-binoculars"></i></div> <div class="step-content"> <h2 class="step-title"><span class="step-number">1</span>VISTA RÁPIDA</h2> <ul class="step-details"> <li><label><input type="checkbox" class="task-checkbox" id="task-1-1"><i class="fas fa-list-ul task-icon"></i><span class="task-text">Índice</span><span class="tool-tag tag-madera">MADERA</span></label></li> <li><label><input type="checkbox" class="task-checkbox" id="task-1-2"><i class="fas fa-download task-icon"></i><span class="task-text">Descargar guías</span><span class="optional-tag">* opcional</span></label></li> <li><label><input type="checkbox" class="task-checkbox" id="task-1-3"><i class="fas fa-brain task-icon"></i><span class="task-text">CREA resúmenes + casos con IA (5min)</span><span class="tool-tag tag-ia">IAGOOGLE</span></label></li> </ul> </div> </div>
                    <div class="parallel-steps-container"> <div class="step-card step-2"> <div class="step-icon-container"><i class="fas fa-magic"></i></div> <div class="step-content"> <h2 class="step-title"><span class="step-number">2</span>CREAR</h2> <ul class="step-details"> <li><label><input type="checkbox" class="task-checkbox" id="task-2-1"><i class="fas fa-chalkboard-teacher task-icon"></i><span class="task-text">Presentación</span><span class="tool-tag tag-genspark">Genspark</span></label></li> <li><label><input type="checkbox" class="task-checkbox" id="task-2-2"><i class="fas fa-microphone-alt task-icon"></i><span class="task-text">Podcast MP3</span><span class="tool-tag tag-notebooklm">NOTEBOOKLM</span></label></li> </ul> </div> </div> <div class="step-card step-3"> <div class="step-icon-container"><i class="fas fa-book-reader"></i></div> <div class="step-content"> <h2 class="step-title"><span class="step-number">3</span>LEER</h2> <ul class="step-details"> <li><label><input type="checkbox" class="task-checkbox" id="task-3-1"><i class="fas fa-file-alt task-icon"></i><span class="task-text">Leer Resumen</span></label></li> </ul> </div> </div> </div>
                    <div class="step-card step-4"> <div class="step-icon-container"><i class="fas fa-puzzle-piece"></i></div> <div class="step-content"> <h2 class="step-title"><span class="step-number">4</span>UNIFICAR<span class="subtitle">(resumen + presentación + simular + enlaces)</span></h2> <ul class="step-details"> <li><label><input type="checkbox" class="task-checkbox" id="task-4-1"><i class="fas fa-code task-icon"></i><span class="task-text">HTML</span><span class="tool-tag tag-ia">IAGOOGLE</span></label></li> </ul> </div> </div>
                    <div class="step-card step-5"> <div class="step-icon-container"><i class="fas fa-tasks"></i></div> <div class="step-content"> <h2 class="step-title"><span class="step-number">5</span>PRACTICAR</h2> <div class="practice-step-layout"> <div class="practice-tasks-column"> <ul class="step-details"> <li><label><input type="checkbox" class="task-checkbox" id="task-5-1"><i class="fas fa-notes-medical task-icon"></i><span class="task-text">Realiza CASOS CLÍNICOS</span></label></li> <li><label><input type="checkbox" class="task-checkbox" id="task-5-2"><i class="fas fa-redo-alt task-icon"></i><span class="task-text">Repasar</span><span class="tool-tag tag-genspark">GENSPARK</span><span class="tool-tag tag-madera">MADERAS</span></label></li> </ul> </div> <div class="practice-score-column"> <h3>PUNTUACIÓN</h3> <div class="score-inputs-row"> <div class="score-input-group"><label for="score-aciertos">Aciertos:</label><input type="number" id="score-aciertos" min="0"></div> <div class="score-input-group"><label for="score-reactivos">Reactivos:</label><input type="number" id="score-reactivos" min="0"></div> <div class="score-input-group"><label for="score-percentage">%:</label><input type="text" id="score-percentage" class="percentage-output" readonly value="0%"></div> </div> </div> </div> </div> </div>
                    <div class="step-card step-6"> <div class="step-icon-container"><i class="fas fa-head-side-headphones"></i></div> <div class="step-content"> <h2 class="step-title"><span class="step-number">6</span>MEMORIZAR</h2> <ul class="step-details"> <li><label><input type="checkbox" class="task-checkbox" id="task-6-1"><i class="fas fa-headphones-alt task-icon"></i><span class="task-text">Escuchar MP3</span></label></li> </ul> </div> </div>
                </div>
                <div class="topic-modal-footer"> <button id="topic-finish-btn" class="topic-finish-btn">Terminar Tema</button> </div>
            </div>
        </div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        const firebaseConfig={apiKey:"AIzaSyD4SjKhedm4ZWHed70_sjQgxPokjHvwvUc",authDomain:"frecuencia-vital.firebaseapp.com",projectId:"frecuencia-vital",storageBucket:"frecuencia-vital.appspot.com",messagingSenderId:"492064882273",appId:"1:492064882273:web:46ad9f9a66126bfdb53420",measurementId:"G-0C466YCX31"};firebase.apps.length||firebase.initializeApp(firebaseConfig);const auth=firebase.auth(),db=firebase.firestore();let currentUser=null;const loginContainer=document.getElementById("login-container"),mainAppContent=document.getElementById("main-app-content"),loginEmailInput=document.getElementById("login-email"),loginPasswordInput=document.getElementById("login-password"),loginButton=document.getElementById("login-button"),signupButton=document.getElementById("signup-button"),logoutButton=document.getElementById("logout-button"),loginError=document.getElementById("login-error");auth.onAuthStateChanged(e=>{e?(loginContainer.style.display="none",mainAppContent.style.display="flex",currentUser=e,initializeAppLogic()):(loginContainer.style.display="flex",mainAppContent.style.display="none",currentUser=null)}),loginButton.addEventListener("click",()=>{const e=loginEmailInput.value,t=loginPasswordInput.value;loginError.textContent="",auth.signInWithEmailAndPassword(e,t).catch(e=>{loginError.textContent="Error: "+e.message})}),signupButton.addEventListener("click",()=>{const e=loginEmailInput.value,t=loginPasswordInput.value;loginError.textContent="",auth.createUserWithEmailAndPassword(e,t).catch(e=>{loginError.textContent="Error: "+e.message})}),logoutButton.addEventListener("click",()=>{auth.signOut()});async function initializeAppLogic(){const e=new Map,t=["La disciplina es el puente entre metas y logros.","El éxito es la suma de pequeños esfuerzos repetidos día tras día.","No te detengas hasta que te sientas orgulloso.","Cree en ti mismo y todo será posible.","El único modo de hacer un gran trabajo es amar lo que haces."];let n,o,a=null;const s=["task-1-1","task-1-2","task-1-3","task-2-1","task-2-2","task-3-1","task-4-1","task-5-1","task-5-2","task-6-1"];let i,l,c,d,r,p,u,m,h,g,f,k,y,b,w,v,S,x,E,L,C,T,D,N;function A(){i=document.getElementById("calendar-view"),l=document.getElementById("board-view"),c=document.getElementById("view-switcher"),d=document.getElementById("calendar-container"),r=document.getElementById("col-todo-container"),p=document.getElementById("col-inprogress-container"),u=document.getElementById("col-done-container"),m=document.getElementById("details-modal"),h=document.getElementById("modal-overlay"),g=document.getElementById("modal-title"),f=document.getElementById("modal-topics"),k=document.getElementById("modal-notes"),y=document.getElementById("modal-save-btn"),b=document.getElementById("topic-plan-modal"),w=document.getElementById("topic-plan-overlay"),v=document.getElementById("topic-plan-title"),S=b.querySelectorAll(".step-card"),x=b.querySelectorAll(".task-checkbox"),E=document.getElementById("score-aciertos"),L=document.getElementById("score-reactivos"),C=document.getElementById("score-percentage"),T=document.getElementById("topic-finish-btn"),D=document.getElementById("global-score-bar"),N=document.getElementById("global-advance-bar"),editCountdownBtn=document.getElementById("edit-countdown-btn"),countdownEditor=document.getElementById("countdown-editor"),countdownDatePicker=document.getElementById("countdown-date-picker"),saveCountdownBtn=document.getElementById("save-countdown-btn"),quoteContainer=document.getElementById("motivational-quote-container")}function B(){const e=!i.classList.contains("hidden");e?(i.classList.add("hidden"),l.classList.remove("hidden"),c.innerHTML='<i class="far fa-calendar-alt"></i> Calendario Vital',c.dataset.currentView="board",K()):(l.classList.add("hidden"),i.classList.remove("hidden"),c.innerHTML='<i class="fas fa-columns"></i> Tablero Vital',c.dataset.currentView="calendar",G())}function M(e){return`topic_${e.toLowerCase().replace(/[^a-z0-9]/g,"")}`}function P(e){return e>=80?"var(--vfd-green)":e>=60?"var(--warning-color)":"var(--error-color)"}async function I(){if(!currentUser)return;const e=db.collection("userProgress").doc(currentUser.uid),t=await e.get();o=t.exists?t.data():{}}async function F(e,t){if(!currentUser)return;const n=db.collection("userProgress").doc(currentUser.uid),a=e.split(".");let s=o;for(let e=0;e<a.length-1;e++)s=s[a[e]]=s[a[e]]||{};s[a[a.length-1]]=t;const i={};let l=i;for(let e=0;e<a.length-1;e++)l[a[e]]={},l=l[a[e]];l[a[a.length-1]]=t,await n.set(i,{merge:!0})}async function _(){const e={GENÉTICA:{"Síndrome de Down":{aciertos:0,reactivos:0,completedTasks:10,totalTasks:10},"Síndrome de Klinefelter":{aciertos:0,reactivos:0,completedTasks:10,totalTasks:10},"Síndrome de Turner":{aciertos:0,reactivos:0,completedTasks:10,totalTasks:10},"Síndrome de Marfan":{aciertos:0,reactivos:0,completedTasks:10,totalTasks:10},"Enfermedad de Wilson":{aciertos:0,reactivos:0,completedTasks:10,totalTasks:10},"Síndrome de Dravet":{aciertos:0,reactivos:0,completedTasks:10,totalTasks:10},"Síndrome de Lynch":{aciertos:0,reactivos:0,completedTasks:10,totalTasks:10},"Síndrome de Peutz Jegher":{aciertos:0,reactivos:0,completedTasks:10,totalTasks:10},"Von Hippel Lindau":{aciertos:0,reactivos:0,completedTasks:10,totalTasks:10}},GERIATRÍA:{"Valoración geriátrica":{aciertos:18,reactivos:21,completedTasks:10,totalTasks:10},Alzheimer:{aciertos:12,reactivos:15,completedTasks:10,totalTasks:10},Delirium:{aciertos:7,reactivos:15,completedTasks:10,totalTasks:10},"Demencia vascular":{aciertos:8,reactivos:9,completedTasks:10,totalTasks:10},"Deterioro cognitivo":{aciertos:15,reactivos:21,completedTasks:10,totalTasks:10},"Insomnio en el adulto mayor":{aciertos:9,reactivos:9,completedTasks:10,totalTasks:10},"Síndrome de caídas":{aciertos:7,reactivos:9,completedTasks:10,totalTasks:10},"Síndrome de fragilidad":{aciertos:15,reactivos:21,completedTasks:10,totalTasks:10},"Maltrato en el adulto mayor":{aciertos:8,reactivos:9,completedTasks:10,totalTasks:10},"Colapso del cuidador":{aciertos:15,reactivos:21,completedTasks:10,totalTasks:10},"Depresión mayor":{aciertos:9,reactivos:9,completedTasks:10,totalTasks:10}},PSIQUIATRÍA:{"Abuso de sustancias":{aciertos:11,reactivos:15,completedTasks:10,totalTasks:10},"Abstinencia alcohólica":{aciertos:12,reactivos:12,completedTasks:10,totalTasks:10},"Trastorno por alcohol":{aciertos:9,reactivos:15,completedTasks:10,totalTasks:10},Esquizofrenia:{aciertos:10,reactivos:15,completedTasks:10,totalTasks:10},"Estrés post traumático":{aciertos:3,reactivos:9,completedTasks:10,totalTasks:10},"Trastornos del sueño":{aciertos:10,reactivos:15,completedTasks:10,totalTasks:10},"Intento de suicidio":{aciertos:8,reactivos:9,completedTasks:10,totalTasks:10},Tdah:{aciertos:8,reactivos:12,completedTasks:10,totalTasks:10},"Trastorno bipolar":{aciertos:13,reactivos:15,completedTasks:10,totalTasks:10},"Trastornos de ansiedad":{aciertos:10,reactivos:15,completedTasks:10,totalTasks:10},"Trastornos de conducta alimentaria":{aciertos:13,reactivos:15,completedTasks:10,totalTasks:10},"Consumo de mariguana":{aciertos:14,reactivos:15,completedTasks:10,totalTasks:10},"Violencia contra la mujer":{aciertos:12,reactivos:15,completedTasks:10,totalTasks:10},Autismo:{aciertos:8,reactivos:9,completedTasks:10,totalTasks:10},"Síndrome de Munchausen":{aciertos:8,reactivos:9,completedTasks:10,totalTasks:10}},DERMATOLOGÍA:{"Dermatitis atópica":{aciertos:18,reactivos:18,completedTasks:10,totalTasks:10},Dermatofitosis:{aciertos:16,reactivos:18,completedTasks:10,totalTasks:10},"SSJ y NET":{aciertos:12,reactivos:12,completedTasks:10,totalTasks:10},"Escabiosis - Sarna":{aciertos:12,reactivos:12,completedTasks:10,totalTasks:10},Impétigo:{aciertos:7,reactivos:12,completedTasks:10,totalTasks:10},Melanoma:{aciertos:8,reactivos:12,completedTasks:10,totalTasks:10},Psoriasis:{aciertos:8,reactivos:12,completedTasks:10,totalTasks:10},"Carcinoma basocelular":{aciertos:10,reactivos:12,completedTasks:10,totalTasks:10},"Acné vulgar":{aciertos:9,reactivos:9,completedTasks:10,totalTasks:10},Erisipela:{aciertos:7,reactivos:9,completedTasks:10,totalTasks:10},Urticaria:{aciertos:7,reactivos:9,completedTasks:10,totalTasks:10},"Dermatitis por contacto":{aciertos:6,reactivos:9,completedTasks:10,totalTasks:10},"Pediculosis capitis":{aciertos:11,reactivos:12,completedTasks:10,totalTasks:10},"Síndrome de Ritter":{aciertos:10,reactivos:12,completedTasks:10,totalTasks:10},"Carcinoma espinocelular":{aciertos:9,reactivos:12,completedTasks:10,totalTasks:10}},NEFROLOGÍA:{"Lesión renal aguda":{aciertos:7,reactivos:12,completedTasks:10,totalTasks:10},"Enfermedad renal crónica":{aciertos:10,reactivos:12,completedTasks:10,totalTasks:10},"Nefropatía diabética":{aciertos:7,reactivos:12,completedTasks:10,totalTasks:10},"Síndrome nefrítico y nefrootico":{aciertos:17,reactivos:24,completedTasks:10,totalTasks:10},"Trastorno ácido-base":{aciertos:11,reactivos:12,completedTasks:10,totalTasks:10},"Nefritis lúpica":{aciertos:9,reactivos:12,completedTasks:10,totalTasks:10}},REUMATOLOGÍA:{"Artritis reactiva":{aciertos:8,reactivos:12,completedTasks:10,totalTasks:10},"Artritis reumatoide":{aciertos:10,reactivos:15,completedTasks:10,totalTasks:10},"Espondilitis anquilosante":{aciertos:11,reactivos:12,completedTasks:10,totalTasks:10},Gota:{aciertos:6,reactivos:12,completedTasks:10,totalTasks:10},"Lupus eritematoso sistémico":{aciertos:12,reactivos:15,completedTasks:10,totalTasks:10},"Arteritis de la temporal":{aciertos:9,reactivos:9,completedTasks:10,totalTasks:10},"Granulomatosis de Wegener":{aciertos:6,reactivos:9,completedTasks:10,totalTasks:10},"Artritis séptica":{aciertos:9,reactivos:12,completedTasks:10,totalTasks:10}},NEUMOLOGÍA:{"Asma en pediátricos":{aciertos:11,reactivos:21,completedTasks:10,totalTasks:10},"Exacerbación de asma":{aciertos:8,reactivos:9,completedTasks:10,totalTasks:10},"Cáncer de pulmón":{aciertos:4,reactivos:12,completedTasks:10,totalTasks:10},Epoc:{aciertos:3,reactivos:12,completedTasks:10,totalTasks:10},"Derrame pleural":{aciertos:10,reactivos:12,completedTasks:10,totalTasks:10},Tabaquismo:{aciertos:5,reactivos:9,completedTasks:10,totalTasks:10}},NEUROLOGÍA:{"Cefalea Secundarias":{aciertos:12,reactivos:12,completedTasks:10,totalTasks:10},"Cefaleas primarias":{aciertos:9,reactivos:12,completedTasks:10,totalTasks:10},"Crisis convulsivas":{aciertos:4,reactivos:12,completedTasks:10,totalTasks:10},"Estatus epiléptico":{aciertos:9,reactivos:12,completedTasks:10,totalTasks:10},"Crisis febriles":{aciertos:5,reactivos:12,completedTasks:10,totalTasks:10},"Enfermedad de Parkinson":{aciertos:6,reactivos:9,completedTasks:10,totalTasks:10},"Evc isquémico":{aciertos:10,reactivos:12,completedTasks:10,totalTasks:10},"Hemorragia subaracnoidea":{aciertos:9,reactivos:9,completedTasks:10,totalTasks:10},"Guillain Barré":{aciertos:8,reactivos:9,completedTasks:10,totalTasks:10},"Esclerosis múltiple":{aciertos:5,reactivos:12,completedTasks:10,totalTasks:10},"Evc hemorrágico":{aciertos:6,reactivos:12,completedTasks:10,totalTasks:10},"Miastenia gravis":{aciertos:5,reactivos:9,completedTasks:10,totalTasks:10},"Muerte encefálica":{aciertos:6,reactivos:9,completedTasks:10,totalTasks:10}},HEMATOLOGÍA:{"Anemia generalidades":{aciertos:8,reactivos:18,completedTasks:10,totalTasks:10},"Anemia ferropénica Adultos":{aciertos:8,reactivos:12,completedTasks:10,totalTasks:10},Leucemias:{aciertos:8,reactivos:12,completedTasks:10,totalTasks:10},Linfomas:{aciertos:10,reactivos:15,completedTasks:10,totalTasks:10},"Trombocitopenia inmune":{aciertos:5,reactivos:9,completedTasks:10,totalTasks:10}},INFECTOLOGÍA:{"Brucelosis":{aciertos:3,reactivos:3,completedTasks:10,totalTasks:10},Cisticercosis:{aciertos:7,reactivos:9,completedTasks:10,totalTasks:10},Clostridium:{aciertos:8,reactivos:9,completedTasks:10,totalTasks:10},"Diarrea aguda en adultos":{aciertos:9,reactivos:12,completedTasks:10,totalTasks:10},"Diarrea en niños":{aciertos:10,reactivos:12,completedTasks:10,totalTasks:10},Chinkungunya:{aciertos:7,reactivos:9,completedTasks:10,totalTasks:10},Dengue:{aciertos:6,reactivos:9,completedTasks:10,totalTasks:10},Zika:{aciertos:8,reactivos:9,completedTasks:10,totalTasks:10},Paludismo:{aciertos:7,reactivos:9,completedTasks:10,totalTasks:10},"Salmonella Fiebre tifoidea":{aciertos:7,reactivos:9,completedTasks:10,totalTasks:10},"Sepsis y choque séptico":{aciertos:7,reactivos:9,completedTasks:10,totalTasks:10},"Tuberculosis pulmonar":{aciertos:14,reactivos:21,completedTasks:10,totalTasks:10},"ETS Generalidades":{aciertos:14,reactivos:18,completedTasks:10,totalTasks:10},"VIH Adultos":{aciertos:16,reactivos:21,completedTasks:10,totalTasks:10},"VIH Madre e hijo":{aciertos:17,reactivos:21,completedTasks:10,totalTasks:10},"RV yOportunistas":{aciertos:14,reactivos:21,completedTasks:10,totalTasks:10},"Sarcoma de Kaposi":{aciertos:6,reactivos:9,completedTasks:10,totalTasks:10},Giardiasis:{aciertos:8,reactivos:9,completedTasks:10,totalTasks:10},"Tuberculosis extrapulmonar":{aciertos:10,reactivos:12,completedTasks:10,totalTasks:10},Lepra:{aciertos:5,reactivos:9,completedTasks:10,totalTasks:10},"Medios de cultivo":{aciertos:5,reactivos:9,completedTasks:10,totalTasks:10},Actinomicosis:{aciertos:6,reactivos:9,completedTasks:10,totalTasks:10},"Amebiasis intestinal":{aciertos:7,reactivos:9,completedTasks:10,totalTasks:10},Anquilostomiasis:{aciertos:9,reactivos:9,completedTasks:10,totalTasks:10},Ascariasis:{aciertos:9,reactivos:9,completedTasks:10,totalTasks:10},Aspergilosis:{aciertos:7,reactivos:9,completedTasks:10,totalTasks:10},Coccidioidomicosis:{aciertos:8,reactivos:9,completedTasks:10,totalTasks:10},Difteria:{aciertos:9,reactivos:9,completedTasks:10,totalTasks:10},"Enfermedad de Chagas":{aciertos:7,reactivos:9,completedTasks:10,totalTasks:10},"Enfermedad de Lyme":{aciertos:7,reactivos:9,completedTasks:10,totalTasks:10},Estrongiloidiasis:{aciertos:7,reactivos:9,completedTasks:10,totalTasks:10},"Fascitis necrosante":{aciertos:7,reactivos:9,completedTasks:10,totalTasks:10},"Fiebre de origen desconocido":{aciertos:5,reactivos:9,completedTasks:10,totalTasks:10},"Filariasis linfática":{aciertos:4,reactivos:9,completedTasks:10,totalTasks:10},"Filariasis ocular Loasis":{aciertos:7,reactivos:9,completedTasks:10,totalTasks:10},"Infecciones odontogénicas":{aciertos:6,reactivos:9,completedTasks:10,totalTasks:10},Leishmaniasis:{aciertos:7,reactivos:9,completedTasks:10,totalTasks:10},Leptospirosis:{aciertos:8,reactivos:9,completedTasks:10,totalTasks:10},Mucormicosis:{aciertos:9,reactivos:9,completedTasks:10,totalTasks:10},Oncocercosis:{aciertos:7,reactivos:9,completedTasks:10,totalTasks:10},"Oxiuriasis o enterobiasis":{aciertos:5,reactivos:9,completedTasks:10,totalTasks:10},Poliomielitis:{aciertos:8,reactivos:9,completedTasks:10,totalTasks:10},Rabia:{aciertos:7,reactivos:9,completedTasks:10,totalTasks:10},Tricuriasis:{aciertos:9,reactivos:9,completedTasks:10,totalTasks:10},Triquinosis:{aciertos:8,reactivos:9,completedTasks:10,totalTasks:10},"Neumonía adquirida en la comunidad":{aciertos:3,reactivos:12,completedTasks:10,totalTasks:10},"Neumonía bacteriana adquirida en la comunidad Niños":{aciertos:7,reactivos:12,completedTasks:10,totalTasks:10},Influenza:{aciertos:6,reactivos:9,completedTasks:10,totalTasks:10},Meningitis:{aciertos:10,reactivos:12,completedTasks:10,totalTasks:10},"Encefalitis viral":{aciertos:8,reactivos:9,completedTasks:10,totalTasks:10},"Absceso cerebral":{aciertos:8,reactivos:9,completedTasks:10,totalTasks:10}},ENDOCRINOLOGÍA:{"Diabetes mellitus":{aciertos:12,reactivos:15,completedTasks:10,totalTasks:10},Prediabetes:{aciertos:15,reactivos:15,completedTasks:10,totalTasks:10},"Diabetes en el adulto mayor":{aciertos:6,reactivos:9,completedTasks:10,totalTasks:10},"Diabetes en pediatría":{aciertos:5,reactivos:9,completedTasks:10,totalTasks:10},"Cetoacidosis diabética y EHH":{aciertos:13,reactivos:18,completedTasks:10,totalTasks:10},Hipoglucemia:{aciertos:6,reactivos:9,completedTasks:10,totalTasks:10}},UROLOGÍA:{"Escroto agudo":{aciertos:0,reactivos:0,completedTasks:0,totalTasks:10},"Torsión testicular":{aciertos:0,reactivos:0,completedTasks:0,totalTasks:10},"Hiperplasia prostática benigna":{aciertos:0,reactivos:0,completedTasks:0,totalTasks:10},"Cáncer de próstata":{aciertos:0,reactivos:0,completedTasks:0,totalTasks:10},"Pielonefritis aguda":{aciertos:0,reactivos:0,completedTasks:0,totalTasks:10},"Infección de tracto urinario":{aciertos:0,reactivos:0,completedTasks:0,totalTasks:10},Urolitiasis:{aciertos:0,reactivos:0,completedTasks:0,totalTasks:10},Orquiepididimitis:{aciertos:0,reactivos:0,completedTasks:0,totalTasks:10},"Cáncer testicular":{aciertos:0,reactivos:0,completedTasks:0,totalTasks:10},"Disfunción eréctil":{aciertos:0,reactivos:0,completedTasks:0,totalTasks:10},"Estenosis del meato urinario":{aciertos:0,reactivos:0,completedTasks:0,totalTasks:10},Hidrocele:{aciertos:0,reactivos:0,completedTasks:0,totalTasks:10},Varicocele:{aciertos:0,reactivos:0,completedTasks:0,totalTasks:10},"Prostatitis aguda":{aciertos:0,reactivos:0,completedTasks:0,totalTasks:10},"Cáncer de vejiga":{aciertos:0,reactivos:0,completedTasks:0,totalTasks:10},"Cáncer renal":{aciertos:0,reactivos:0,completedTasks:0,totalTasks:10},"Incontinencia urinaria":{aciertos:0,reactivos:0,completedTasks:0,totalTasks:10},"Retención aguda de orina":{aciertos:0,reactivos:0,completedTasks:0,totalTasks:10}}},t={};for(const n in e)for(const o in e[n]){const i=M(o),l=e[n][o];t[i]={scoreAciertos:l.aciertos,scoreReactivos:l.reactivos},s.forEach((e,n)=>{t[i][e]=l.completedTasks>n})}await F("topicData",t)}function R(){const e={UROLOGÍA:["Escroto agudo","Torsión testicular","Hiperplasia prostática benigna","Cáncer de próstata","Pielonefritis aguda","Infección de tracto urinario","Urolitiasis","Orquiepididimitis","Cáncer testicular","Disfunción eréctil","Estenosis del meato urinario","Hidrocele","Varicocele","Prostatitis aguda","Cáncer de vejiga","Cáncer renal","Incontinencia urinaria","Retención aguda de orina"],ENDOCRINOLOGÍA:["Diabetes mellitus","Prediabetes","Diabetes en el adulto mayor","Diabetes en pediatría","Cetoacidosis diabética y EHH","Hipoglucemia","Enfermedad de Addison","Enfermedad de Cushing / Síndrome de Cushing","Hiperprolactinemia","Acromegalia","Feocromocitoma","Hiperaldosteronismo","Hiperparatiroidismo","Neoplasia endocrina múltple","Alopecia endocrina"],INFECTOLOGÍA:["Brucelosis","Cisticercosis","Clostridium","Diarrea aguda en adultos","Diarrea en niños","Chinkungunya","Dengue","Zika","Paludismo","Salmonella Fiebre tifoidea","Sepsis y choque séptico","Tuberculosis pulmonar","ETS Generalidades","VIH Adultos","VIH Madre e hijo","RV yOportunistas","Sarcoma de Kaposi","Giardiasis","Tuberculosis extrapulmonar","Lepra","Medios de cultivo","Actinomicosis","Amebiasis intestinal","Anquilostomiasis","Ascariasis","Aspergilosis","Coccidioidomicosis","Difteria","Enfermedad de Chagas","Enfermedad de Lyme","Estrongiloidiasis","Fascitis necrosante","Fiebre de origen desconocido","Filariasis linfática","Filariasis ocular Loasis","Infecciones odontogénicas","Leishmaniasis","Leptospirosis","Mucormicosis","Oncocercosis","Oxiuriasis o enterobiasis","Poliomielitis","Rabia","Tricuriasis","Triquinosis","Neumonía adquirida en la comunidad","Neumonía bacteriana adquirida en la comunidad Niños","Influenza","Meningitis","Encefalitis viral","Absceso cerebral"],HEMATOLOGÍA:["Anemia generalidades","Anemia ferropénica Adultos","Leucemias","Linfomas","Trombocitopenia inmune"],NEUROLOGÍA:["Cefalea Secundarias","Cefaleas primarias","Crisis convulsivas","Estatus epiléptico","Crisis febriles","Enfermedad de Parkinson","Evc isquémico","Hemorragia subaracnoidea","Guillain Barré","Esclerosis múltiple","Evc hemorrágico","Miastenia gravis","Muerte encefálica"],NEUMOLOGÍA:["Asma en pediátricos","Exacerbación de asma","Cáncer de pulmón","Epoc","Derrame pleural","Tabaquismo"],REUMATOLOGÍA:["Artritis reactiva","Artritis reumatoide","Espondilitis anquilosante","Gota","Lupus eritematoso sistémico","Arteritis de la temporal","Granulomatosis de Wegener","Artritis séptica"],NEFROLOGÍA:["Lesión renal aguda","Enfermedad renal crónica","Nefropatía diabética","Síndrome nefrítico y nefrootico","Trastorno ácido-base","Nefritis lúpica"],DERMATOLOGÍA:["Dermatitis atópica","Dermatofitosis","SSJ y NET","Escabiosis - Sarna","Impétigo","Melanoma","Psoriasis","Carcinoma basocelular","Acné vulgar","Erisipela","Urticaria","Dermatitis por contacto","Pediculosis capitis","Síndrome de Ritter","Carcinoma espinocelular"],PSIQUIATRÍA:["Abuso de sustancias","Abstinencia alcohólica","Trastorno por alcohol","Esquizofrenia","Estrés post traumático","Trastornos del sueño","Intento de suicidio","Tdah","Trastorno bipolar","Trastornos de ansiedad","Trastornos de conducta alimentaria","Consumo de mariguana","Violencia contra la mujer","Autismo","Síndrome de Munchausen","Depresión mayor"],GERIATRÍA:["Valoración geriátrica","Alzheimer","Delirium","Demencia vascular","Deterioro cognitivo","Insomnio en el adulto mayor","Síndrome de caídas","Síndrome de fragilidad","Maltrato en el adulto mayor","Colapso del cuidador","Depresión mayor"],GENÉTICA:["Síndrome de Down","Síndrome de Klinefelter","Síndrome de Turner","Síndrome de Marfan","Enfermedad de Wilson","Síndrome de Dravet","Síndrome de Lynch","Síndrome de Peutz Jegher","Von Hippel Lindau"]},t={ORL:["Epistaxis","Fracturas nasales","Faringoamigdalitis","Angina de Ludwig","Mastoiditis aguda","Otitis","Parálisis de Bell","Neuralgia de trigémino","Neuritis vestibular","Rinosinusitis","VPPB"],OFTALMOLOGÍA:["Conjuntivitis (alergica, bacteriana, neonatal, viral)","Blefaritis","Chalazión","Orzuelo","Glaucoma de ángulo abierto","Glaucoma de ángulo cerrado","Glaucoma congénito","Ojo rojo","Catarata","Degeneración macular","Desprendimiento de retina","Retinopatía diabética","Retinopatía hipertensiva","Trauma ocular"],TYO:["Osteoartritis","Osteomielitis","Osteosarcoma","Sarcoma de Ewing","Tumores óseos malignos","Embolia grasa","Costilla cervical","Esguince cervical","Lumbalgia","Hernia de disco","Túnel del carpo","Síndrome de hombro doloroso","Fractura de clavícula","Fractura de húmero proximal","Luxación glenohumeral","Luxación de codo","Codo de niñera","Fracturas de codo","Fracturas de antebrazo","Fractura de radio distal","Lesiones fisiarias","Fracturas expuestas","Fractura de cadera","Epifisiolistesis femoral","Legg Calvé Perthes","Luxación coxofemoral","Lesiones de rodilla","Fractura de diáfisis de tibia","Esguince de tobillo","Fractura de tobillo","Rotura de talón de Aquiles","Pie equino varo","Pie plano"],CARDIOLOGÍA:["Fiebre reumática","Estenosis aórtica","Insuficiencia aórtica","Estenosis mitral","Insuficiencia mitral","Otras valvulopatías","Pericarditis","Endocarditis infecciosa","Infarto agudo de miocardio","Enfermedad coronaria","Disección aórtica","Aneurisma aórtico abdominal","Cor pulmonar crónico","Hipertensión arterial sistémica","Crisis hipertensivas","Hipertensión pulmonar","Insuficiencia cardíaca aguda","Insuficiencia cardíaca crónica","Edema pulmonar","Hipotensión ortostática","Rehabilitación cardíaca"],ANGIOLOGÍA:["Enfermedad arterial periférica","Insuficiencia venosa","Pie diabético","Trombosis venosa profunda","Tromboembolia pulmonar","Paget Schroetter","Tromboembolia venosa en obstetricia","Úlceras por presión"],ACLS:["Soporte vital básico","RCP","Taquicardia ACLS","Taquicardia supraventricular","Bloqueos AV","Bradicardia","Fibrilación auricular","Fibrilación ventricular","Síndrome de WPW","PLS","Ahogamiento"],ATLS:["Politrauma","Tipos de shock","Choque hipovolémico","Shock neurogénico","TCE adultos","TCE pediátrico","Fracturas de cráneo","Trauma torácico","Hemotórax","Neumotórax a tensión","Neumotórax abierto","Neumotórax simple","Taponamiento cardíaco","Lesión traqueobronquial","Trauma abdominal","Ruptura diafragmática","Trauma esplénico","Trauma espinal","Trauma pélvico","Trauma obstétrico","Quemaduras","Gran quemado","Catéter venoso central","Hipotermia"],TOXICOLOGÍA:["Manejo de intoxicaciones","Toxíndromes","Intoxicación por benzodiacepinas","Intoxicación por organofosforados","Intoxicación por paracetamol","Intoxicación por salicilatos","Intoxicación por etanol","Intoxicación por monóxido de carbono","Intoxicación por opiáceos","Intoxicación por anfetaminas","Intoxicación por fentanilo","Intoxicación por DMT","Intoxicación por hidrocarburos","Intoxicación por metales pesados","Intoxicación por plomo","Intoxicación por alcoholes","Ingesta de cáusticos","Intoxicación alimentaria","Anafilaxia","Picadura de alacrán","Mordedura de serpiente","Lactrodectus","Loxosceles","Picadura de himenópteros","Golpe de calor"],GASTROENTEROLOGÍA:["Reflujo ERGE","Enfermedad ácido péptica","Síndrome de intestino irritable","Dispepsia funcional","Mallory Weiss","Zollinger Ellison","Acalasia","Esófago de Barrett","Enfermedad celíaca","Enfermedad de Crohn","Colitis ulcerativa","Enfermedad diverticular","Sangrado TDA","Sangrado TDB","Varices esofágicas","EHGNA","Hepatitis A","Hepatitis B","Hepatitis C","Hepatitis autoinmune","Absceso hepático amebiano","Absceso hepático piógeno","Cirrosis hepática","Insuficiencia hepática","Ascitis","Encefalopatía hepática","Pancreatitis aguda","Pancreatitis crónica","Cáncer gástrico","Cáncer de esófago","Cáncer de páncreas","Carcinoma hepatocelular"],"CIRUGÍA ABDOMINAL Y COLOPROCTOLOGÍA":["Apendicitis aguda","Apendicitis en el embarazo","Hernias","Hernia inguinal","Hernia femoral","Hernia hiatal","Hernia umbilical","Hernia ventral","Colecistitis aguda","Colelitiasis","Coledocolitiasis","Colangitis aguda","Oclusión intestinal","Isquemia intestinal","Vólvulo de sigmoides","Vólvulo de ciego","Enfermedad hemorroidal","Fístula anal","Fisura anal","Absceso anal","Quiste pilonidal","Cáncer colorrectal","Poliposis adenomatosa familiar PAF","Fístulas biliointestinales","Colangiocarcinoma","Complicaciones post Qx","Heridas quirúrgicas"],"CIRUGÍA PEDIÁTRICA":["Atresia esofágica","Atresia duodenal","Atresia yeyunoileal","Atresia biliar","Atresia de coanas","Estenosis pilórica","Hernia diafragmática congénita","Malrotación intestinal","Invaginación intestinal","Divertículo de Meckel","Hirschsprung","Enfermedad de Hirschsprung","Patología umbilical","Criptorquidia","Espina bífida","Malformaciones rectales","Retinoblastoma","Nefroblastoma","Neuroblastoma","Tumor abdominal"],"GINECOLOGÍA":["Amenorreas primarias","Amenorreas secundarias","Sangrado uterino anormal","Dismenorrea aguda","Adenomiosis","Endometriosis","Miomatosis uterina","Hiperplasia endometrial","Quiste de ovario benigno","Torsión ovárica","Ovario poliquístico","Enfermedad pélvica inflamatoria","Hidrosalpinx","Fitz-Hugh-Curtis","Vaginitis bacteriana","Vaginitis infecciosa","Tricomoniasis","Bartolinitis","Candidiasis vulvovaginal","Chlamydia","Mastitis","Mastopatía fibroquística","Fibroadenoma","Papiloma intraductal","Quiste mamario","Patología mamaria benigna","Osteoporosis post menopausia","Menopausia y climaterio","Insuficiencia ovárica primaria","Anticonceptivos generalidades","Anticonceptivos GPC","Anticonceptivos hormonales combinados","Anticoncepción de emergencia","DIU de cobre","DIU de levonorgestrel","Implante subdérmico","Progestágenos solos","Lactancia como anticonceptivo","Condón","Vasectomía","Oclusión tubaria bilateral OTB","Infertilidad","Cistocele e incontinencia"],"ONCOGINE":["Tamizaje cáncer de mama","Cáncer de mama","Cáncer cérvicouterino","Cáncer de endometrio","Cáncer de ovario","Cáncer de vagina","Tumores anexiales"],"OBSTETRICIA":["Control prenatal","Aloinmunización materna","Estática fetal","Tipos de pelvis","Atención del parto","Manejo activo del parto","Cesárea","Parto pretérmino","Puerperio fisiológico","Líquido amniótico","Ruptura prematura de membranas","Corioamnionitis","Distocias","Embarazo múltiple","Endometritis puerperal","Hiperémesis gravídica","Insuficiencia cervical","Muerte fetal","Enfermedades hipertensivas del embarazo","Preeclampsia sin datos de severidad","Síndrome de HELLP","Diabetes gestacional","IVU en el embarazo","Restricción del crecimiento intrauterino","Sepsis puerperal","Síndrome de Sheehan","Depresión posparto"],"HEMORRAGIAS OBSTÉTRICAS":["Generalidades de hemorragias","Hemorragia postparto","Desgarro perineal","Amenaza de aborto","Aborto espontáneo","Acretismo placentario","Atonía uterina","Choque hemorrágico en obstetricia","Desprendimiento prematuro de placenta normoinserta","Embarazo ectópico","Placenta previa","Ruptura uterina","Vasa previa","Enfermedad trofoblástica gestacional"],"NEONATOLOGÍA":["APGAR","Reanimación neonatal","Prematuro sano","Recién nacido de término","Apnea del prematuro","Asfixia neonatal","Síndrome de dificultad respiratoria","Taquipnea transitoria del recién nacido","Síndrome de aspiración de meconio","Displasia broncopulmonar","Silverman Anderson","Maduración pulmonar","Encefalopatía hipóxica","Enfermedad hemorrágica del recién nacido","Enterocolitis necrotizante","Hipoacusia neonatal","Hipoglucemia neonatal","Ictericia neonatal","Muerte súbita del lactante","Sepsis neonatal","Tamiz neonatal","Lesiones de plexo braquial obstétrico","Lesiones extracraneales","Displasia del desarrollo de la cadera DDC"],"CONGENITAS":["Cardiopatías congénitas","Tetralogía de Fallot","Coartación aórtica","Persistencia del conducto arterioso","Fibrosis quística","Fenilcetonuria","Galactosemia clásica","STORCH","STORCH Citomegalovirus","STORCH Herpes simple","STORCH Rubéola congénita","STORCH Sífilis congénita","STORCH Toxoplasmosis","STORCH Varicela congénita"],"ESCOLAR":["Control de niño sano","Etapas del crecimiento","Talla baja","Alergia alimentaria","Cuerpo extraño","Dermatitis del pañal","Estreñimiento funcional","Hiperplasia adrenal congénita","Hipotiroidismo congénito","Maltrato infantil","Mucopolisacaridosis","Reflujo gastroesofágico del lactante"],"NUTRICIÓN PEDIÁTRICA":["Lactancia materna","Alimentación complementaria","Desnutrición pediátrica","Deficiencia de vitamina A","Hipovitaminosis","Raquitismo carencial","Pelagra en niños","Intolerancia a la lactosa","Obesidad en escolares","Síndrome metabólico en niños"],"INFECTOLOGÍA PEDIÁTRICA":["Adenitis mesentérica","Onfalitis","Exantemáticas Diferencial","Eritema infeccioso","Escarlatina","Exantema súbito","Enfermedad de Kawasaki","Síndrome mano pie boca","Rubéola","Sarampión","Varicela","Parotiditis","Bronquiolitis","Epiglotitis","Laringotraqueitis CRUP","Mononucleosis infecciosa","Tos ferina","IVU en menores"],"VACUNAS":["Vacunas generalidades","Tipos de vacunas","Vacunación universal","Aplicación de vacunas","Vacuna para personal de salud","Vacunas en el embarazo","Esquema de vacunación","BCG","Hepatitis A","Hepatitis B","Hexavalente","Influenza","Neumocócica","Rotavirus","Sabin","Salmonella","DPT","SRP","Tétanos","Varicela","VPH"]},n=[],o=[],a=[];let i,l=[],c=new Date("2025-06-27");for(let t of(Object.keys(e).forEach(t=>{e[t].forEach(e=>{o.push({specialty:t,topic:e})})}),o)){let e=new Date("2025-06-27");for(;o.length>0;){e.setDate(e.getDate()-1);const t=Math.min(o.length,Math.floor(4*Math.random())+4),n=o.splice(0,t),a={date:e.toISOString().split("T")[0],blocks:[]};let s=null;n.forEach(e=>{e.specialty!==s?(a.blocks.push({subject:e.specialty,topics:[e.topic]}),s=e.specialty):a.blocks[a.blocks.length-1].topics.push(e.topic)}),l.push(e.toISOString().split("T")[0])}}let r=new Date("2025-06-27"),p=new Date("2025-09-20"),u=(p.getTime()-r.getTime())/864e5+1;Object.keys(t).forEach(e=>{t[e].forEach(t=>{a.push({specialty:e,topic:t})})});const m=a.length,h=Math.floor(m/u),g=m%u;let f=[],k=new Date(r),y=0;for(let e=0;e<u;e++){const t=h+(e<g?1:0),n=a.slice(y,y+t);if(y+=t,0===n.length)continue;const o={date:k.toISOString().split("T")[0],blocks:[]};let s=null;n.forEach(e=>{e.specialty!==s?(o.blocks.push({subject:e.specialty,topics:[e.topic]}),s=e.specialty):o.blocks[o.blocks.length-1].topics.push(e.topic)}),f.push(o),k.setDate(k.getDate()+1)}let b=[...l,...f],w=new Date(k.setDate(k.getDate()-1)),v=new Date("2025-09-30");for(;w<v;)w.setDate(w.getDate()+1),b.push({date:w.toISOString().split("T")[0],blocks:[]});return b.sort((e,t)=>new Date(e.date)-new Date(t.date))}function q(e,t=null){const n=e.split(".");let a=o;for(const e of n){if(!a||"object"!=typeof a||!(e in a))return t;a=a[e]}return a}function O(e){return s.every(t=>"true"===q(`topicData.${e}.${t}`))}function j(t){const n=q(`topicData.${t}.scoreReactivos`,"0")||0;return n>0?(q(`topicData.${t}.scoreAciertos`,"0")||0)/n*100:0}function z(){if(quoteContainer){const n=Math.floor(Math.random()*t.length);quoteContainer.textContent=t[n]}}function Y(){if(a)clearInterval(a);if(!n)return;const e=(new Date(n+"T08:00:00")).getTime(),t=document.getElementById("countdown-days"),o=document.getElementById("countdown-hours"),s=document.getElementById("countdown-minutes"),i=document.getElementById("countdown-seconds"),l=()=>{const n=(new Date).getTime(),c=e-n;c<0?(t.textContent="000",o.textContent="00",s.textContent="00",i.textContent="00",clearInterval(a)):(t.textContent=String(Math.floor(c/864e5)).padStart(3,"0"),o.textContent=String(Math.floor(c%864e5/36e5)).padStart(2,"0"),s.textContent=String(Math.floor(c%36e5/6e4)).padStart(2,"0"),i.textContent=String(Math.floor(c%6e4/1e3)).padStart(2,"0"))};l(),a=setInterval(l,1e3)}function U(t){const n=M(t),o=O(n),a=`topic-item ${o?"topic-completed":""}`;let s="";const i=j(t);return i>0&&(s=`<span class="topic-score" style="color: ${P(i)};">(${i.toFixed(1)}%)</span>`),`<li class="${a}" draggable="true" data-topic-id="${n}" data-topic-name="${t}"><span>${t}</span>${s}</li>`}function V(){e.clear();if(!n)return;let t=null;n.forEach(o=>{o.blocks.forEach(n=>{n.subject&&(t=n.subject),t&&(e.has(t)||e.set(t,[]),n.topics&&n.topics.map(M).forEach(o=>{e.get(t).includes(o)||e.get(t).push(o)}))})})}function H(t){const n=e.get(t);if(!n||0===n.length)return null;let o=0,a=0;return n.forEach(e=>{const t=q(`topicData.${e}.scoreReactivos`)||0;t>0&&(o+=j(e),a++)}),a>0?(o/a).toFixed(2):null}function W(){if(!n)return;V();let t=0;e.forEach(e=>{t+=e.length});let a=0;e.forEach(e=>{e.forEach(e=>{O(e)&&a++})});const s=t>0?a/t*100:0;N.style.width=`${s}%`,N.textContent=`${s.toFixed(1)}%`;let i=0,l=0;e.forEach((e,t)=>{const n=H(t);null!==n&&(i+=parseFloat(n),l++)});const c=l>0?i/l:0;D.style.width=`${c}%`,D.textContent=`${c.toFixed(1)}%`}function G(){if(!n)return;V();const t=new Map(n.map(e=>[e.date,e])),o=new Date(n[0].date+"T00:00:00"),a=new Date("2025-09-30T00:00:00"),s=new Set;let i="2025-09-22",l=[],c=new Date(o);for(c.setDate(c.getDate()-c.getDay());c<=a;){let e=[];for(let t=0;t<7;t++)e.push(new Date(c)),c.setDate(c.getDate()+1);l.push(e)}const r=new Map;l.forEach((e,t)=>{const n=e[0],o=n.toLocaleString("es-ES",{month:"long"});r.has(o)?r.get(o).rowSpan++:r.set(o,{startRow:t+2,rowSpan:1})}),d.innerHTML="",d.innerHTML+='<div class="header-cell meta-header">M</div><div class="header-cell meta-header">S</div>',["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"].forEach(e=>{d.innerHTML+=`<div class="header-cell day-header">${e}</div>`}),r.forEach((e,t)=>{d.innerHTML+=`<div class="month-cell" style="grid-row: ${e.startRow} / span ${e.rowSpan}">${t}</div>`}),l.forEach((l,c)=>{d.innerHTML+=`<div class="week-cell-container" style="grid-row: ${c+2}"><span class="week-number">${c+1}</span></div>`,l.forEach(l=>{const c=document.createElement("div");c.className="day-cell";const r=l.toISOString().split("T")[0];if(l<o||l>a)c.classList.add("empty");else{c.dataset.date=r,c.innerHTML=`<div class="calendar-day-number">${l.getDate()}</div>`;const o=t.get(r);if(o&&o.blocks){let t="<ul>";o.blocks.forEach(o=>{if(o.subject&&!s.has(o.subject)){const n=e.get(o.subject)?.every(O)??!1,a=` subject-completed`,i=H(o.subject),l=null!==i?`<span class="subject-score">(${i}%)</span>`:"";t+=`<li><span class="subject-title${n?a:""}">${o.subject}${l}</span></li>`,s.add(o.subject)}o.topics&&(t+=o.topics.map(U).join(""))}),t+="</ul>",c.innerHTML+=`<div class="day-content">${t}</div>`}r===n&&c.classList.add("target-date"),r===i&&c.classList.add("day-before-target")}d.appendChild(c)})}),W()}function K(){r.innerHTML="",p.innerHTML="",u.innerHTML="";const t=["--step-1-color","--step-2-color","--step-3-color","--step-4-color","--step-5-color","--step-6-color"];let o=0;const a={};V(),e.forEach((e,s)=>{const i=e.map(e=>{for(const t of n)for(const o of t.blocks)if(o.topics){const n=o.topics.find(t=>M(t)===e);if(n)return n}return null}).filter(Boolean);i.length>0&&(a[s]={topics:i,color:t[o%t.length]},o++)});for(const e in a){const t=a[e],n=function(e,t){return`<div class="specialty-header" data-specialty-header="${e}" style="border-left-color: var(${t})"><div class="specialty-header-main"><h3 style="color: var(${t})">${e}</h3></div><div class="specialty-progress-wrapper"><small>Avance</small><div class="specialty-progress-container"><div class="specialty-progress-bar" id="sp-progress-${M(e)}"></div></div><span class="specialty-percentage-text" id="sp-progress-text-${M(e)}">0%</span></div><div class="specialty-progress-wrapper"><small>Nota</small><div class="specialty-progress-container"><div class="specialty-score-bar" id="sp-score-${M(e)}"></div></div><span class="specialty-percentage-text" id="sp-score-text-${M(e)}">0%</span></div></div>`}(e,t.color),o={todo:document.createDocumentFragment(),inprogress:document.createDocumentFragment(),done:document.createDocumentFragment()};t.topics.forEach(t=>{const a=M(t),s=function(e){const t=X(e);return 100===t.completionPercentage?"done":t.completionPercentage>0?"inprogress":"todo"}(a),i=function(t,n,o){const{completionPercentage:a,scorePercentage:s}=X(n),i=P(s);let l="inprogress"===e?"--color-inprogress":"done"===e?"--color-done":"--color-todo";const e=function(e){const t=X(e);return 100===t.completionPercentage?"done":t.completionPercentage>0?"inprogress":"todo"}(n);return`<article class="kanban-card" data-topic-id="${n}" data-topic-name="${t}" data-specialty="${o}" style="border-left: 4px solid var(${l});"><div class="card-summary"><div class="card-topic-name">${t}</div><div class="card-progress-display"><div class="card-progress-bar-container"><div class="card-progress-bar" style="width: ${a}%; background-color: var(${l});"></div></div><span class="card-progress-text">${a.toFixed(0)}%</span><span class="card-score-text" style="color: ${i}">${s.toFixed(0)}%</span></div></div></article>`}(t,a,e);const l=document.createElement("div");l.innerHTML=i,o[s].appendChild(l.firstChild)}),o.todo.hasChildNodes()&&(r.innerHTML+=n,r.appendChild(o.todo)),o.inprogress.hasChildNodes()&&(p.innerHTML+=n,p.appendChild(o.inprogress)),o.done.hasChildNodes()&&(u.innerHTML+=n,u.appendChild(o.done))}!function(){const t=document.querySelectorAll(".specialty-header");t.forEach(t=>{const n=t.dataset.specialtyHeader,o=M(n),a=e.get(n)||[],s=document.getElementById(`sp-progress-text-${o}`),i=document.getElementById(`sp-score-text-${o}`),l=document.getElementById(`sp-progress-${o}`),c=document.getElementById(`sp-score-${o}`);if(!s||!i||!l||!c)return;let d=0,r=0,p=0;a.forEach(e=>{const{completionPercentage:t,scorePercentage:n}=X(e);d+=t;const o=parseInt(q(`topicData.${e}.scoreReactivos`))||0;(o>0||O(e))&&(r+=n,p++)});const u=a.length>0?d/a.length:0,m=p>0?r/p:0;l.style.width=`${u}%`,s.textContent=`${u.toFixed(0)}%`,c.style.width=`${m}%`,i.textContent=`${m.toFixed(0)}%`,c.classList.remove("low","medium","high"),p>0||100===u&&c.classList.add(P(m).includes("error")?"low":P(m).includes("warning")?"medium":"high")})}()}function X(e){const t=s.filter(t=>!0===q(`topicData.${e}.${t}`)).length,n=t/s.length*100,o=parseInt(q(`topicData.${e}.scoreReactivos`,"0"))||0,a=parseInt(q(`topicData.${e}.scoreAciertos`,"0"))||0;return{completionPercentage:n,scorePercentage:o>0?a/o*100:0}}function J(t){const o=n.find(e=>e.date===t),a=new Date(t+"T00:00:00");g.textContent=a.toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"});let s="<ul>";o&&o.blocks&&o.blocks.forEach(t=>{if(t.subject){const n=H(t.subject),o=null!==n?`<span class="subject-score">(${n}%)</span>`:"";s+=`<li><span class="subject-title">${t.subject}${o}</span></li>`}t.topics&&(s+=t.topics.map(U).join(""))}),s+="</ul>",f.innerHTML=s,k.value=q(`dayNotes.${t}`,""),m.dataset.currentDate=t,h.classList.add("visible"),m.classList.add("visible")}function Z(){h.classList.remove("visible"),m.classList.remove("visible")}async function $(){const e=m.dataset.currentDate;e&&await F(`dayNotes.${e}`,k.value),Z()}function Q(e,t){b.dataset.currentTopicId=e,v.textContent=t,ee(e),w.classList.add("visible"),b.classList.add("visible")}function ee(e){x.forEach(t=>{t.checked="true"===String(q(`topicData.${e}.${t.id}`))}),E.value=q(`topicData.${e}.scoreAciertos`,""),L.value=q(`topicData.${e}.scoreReactivos`,""),ne(),oe()}async function te(e,t){const n=b.dataset.currentTopicId;n&&await F(`topicData.${n}.${e}`,t)}function ne(){const e=parseInt(E.value)||0,t=parseInt(L.value)||0;let n=0;t>0&&(n=e/t*100);const o=P(n);C.value=n.toFixed(2)+"%",C.style.color=o}function oe(){S.forEach(ae)}function ae(e){const t=e.querySelectorAll(".task-checkbox");e.classList.toggle("completed",Array.from(t).every(e=>e.checked))}function se(){const e=b.dataset.currentTopicId;w.classList.remove("visible"),b.classList.remove("visible"),e&&ie(e)}function ie(e){!l.classList.contains("hidden")?K():G(),W()}function le(){const t=M(e);for(const[n,o]of e.entries())if(o.includes(t))return n;return null}let ce=null,de=null,re=null;function pe(){ce&&ce.classList.remove("drag-over"),re&&re.classList.remove("drag-over-top","drag-over-bottom"),ce=null,re=null}async function ue(){A(),z(),await I();const e=q("studyPlan");(e&&e.length>0?n=e:(n=R(),await F("studyPlan",n),await _(),await I()),n)||(n=R(),await F("studyPlan",n)),n=q("countdownTarget")||"2025-09-23",await F("countdownTarget",n),countdownDatePicker.value=n,Y(),G(),c.addEventListener("click",B),l.addEventListener("click",e=>{const t=e.target.closest(".kanban-card");t&&Q(t.dataset.topicId,t.dataset.topicName)}),d.addEventListener("click",e=>{const t=e.target.closest(".topic-item");if(t&&!de)return void Q(t.dataset.topicId,t.dataset.topicName);const n=e.target.closest(".day-cell:not(.empty)");n&&J(n.dataset.date)}),f.addEventListener("click",e=>{const t=e.target.closest(".topic-item");t&&Q(t.dataset.topicId,t.dataset.topicName)}),editCountdownBtn.addEventListener("click",()=>{countdownEditor.style.display="flex"===countdownEditor.style.display?"none":"flex"}),saveCountdownBtn.addEventListener("click",async()=>{const e=countdownDatePicker.value;e&&(n=e,await F("countdownTarget",e),Y(),G(),countdownEditor.style.display="none")}),m.querySelector("#modal-close-day").addEventListener("click",Z),h.addEventListener("click",Z),b.querySelector("#modal-close-topic").addEventListener("click",se),T.addEventListener("click",()=>{se()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&(b.classList.contains("visible")?se():m.classList.contains("visible")&&Z())}),y.addEventListener("click",$),x.forEach(e=>{e.addEventListener("change",async function(){const e=b.dataset.currentTopicId;await te(this.id,this.checked),ae(this.closest(".step-card")),ie(e)})}),E.addEventListener("input",async()=>{const e=b.dataset.currentTopicId;await te("scoreAciertos",E.value),ne(),ie(e)}),L.addEventListener("input",async()=>{const e=b.dataset.currentTopicId;await te("scoreReactivos",L.value),ne(),ie(e)}),d.addEventListener("dragstart",e=>{if(e.target.classList.contains("topic-item")){de=e.target;const t=de.dataset.topicName,n=function(t){const n=M(t);for(const[o,a]of e.entries())if(a.includes(n))return o;return null}(t);e.dataTransfer.setData("application/json",JSON.stringify({topicName:t,sourceSubject:n})),setTimeout(()=>{e.target.classList.add("dragging")},0)}}),d.addEventListener("dragend",e=>{de&&(de.classList.remove("dragging"),de=null,pe())}),d.addEventListener("dragover",e=>{e.preventDefault();const t=e.target.closest(".day-cell:not(.empty)");if(!t||!de)return void pe();const n=de.closest(".day-cell").dataset.date,o=t.dataset.date;if(pe(),n===o){const n=e.target.closest(".topic-item");n&&n!==de&&(re=n,n.getBoundingClientRect().top+n.getBoundingClientRect().height/2>e.clientY?n.classList.add("drag-over-top"):n.classList.add("drag-over-bottom"))}else ce=t,t.classList.add("drag-over")}),d.addEventListener("drop",async e=>{e.preventDefault();if(!de)return;const t=e.target.closest(".day-cell");if(!t||t.classList.contains("empty"))return void pe();const o=de.closest(".day-cell"),a=o.dataset.date,s=t.dataset.date,{topicName:i,sourceSubject:l}=JSON.parse(e.dataTransfer.getData("application/json"));const c=n.find(e=>e.date===a);if(!c)return;let r=!1;if(c.blocks.forEach(e=>{if(e.topics){const t=e.topics.indexOf(i);t>-1&&(e.topics.splice(t,1),r=!0)}}),!r)return;let p=n.find(e=>e.date===s);p||(p={date:s,blocks:[{topics:[]}]},n.push(p));let u=p.blocks.find(e=>function(t){const n=M(t);for(const[o,a]of e.entries())if(a.includes(n))return o;return null}(e.topics?.[0])===l||e.subject===l);u||(u={topics:[]},p.blocks.unshift(u));const m=e.target.closest(".topic-item");if(m&&a===s){const t=m.dataset.topicName,n=m.getBoundingClientRect(),o=n.top+n.height/2,a=e.clientY<o,s=u.topics.indexOf(t);u.topics.splice(a?s:s+1,0,i)}else u.topics.push(i);n.forEach(e=>{e.blocks=e.blocks.filter(e=>e.subject&&e.topics&&e.topics.length>0||!e.subject&&e.topics&&e.topics.length>0||e.subject&&!e.topics)}),n=n.filter(e=>e.blocks.length>0&&e.blocks.some(e=>e.topics&&e.topics.length>0||e.subject)),n.sort((e,t)=>new Date(e.date)-new Date(t.date)),pe(),await F("studyPlan",n),G()})}ue()}
    </script>
</body>
</html>
